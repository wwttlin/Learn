# 🛠️ 修復工具說明

## 快速選擇

| 問題 | 使用工具 | 說明 |
|------|---------|------|
| 🔴 所有問題 | `./一鍵修復.sh` | 自動修復所有常見問題 |
| 🌐 Nginx 問題 | `./fix-nginx.sh` | 診斷並修復 Nginx |
| ⚙️ 重新配置 Nginx | `./setup-nginx.sh` | 完整配置 Nginx（保留 SSL） |
| 🎨 只更新前端 | `./update-frontend.sh` | 快速更新前端代碼 |
| 🔍 診斷問題 | `./diagnose-api.sh` | 完整系統診斷 |
| 📊 查看狀態 | `./manage.sh status` | 查看服務狀態 |

---

## 📁 工具列表

### 🚀 一鍵修復工具

#### `一鍵修復.sh` ⭐ 推薦
**用途**: 自動修復所有問題  
**執行**:
```bash
chmod +x 一鍵修復.sh
./一鍵修復.sh
```

**功能**:
- ✅ 檢查並修復 Nginx 配置
- ✅ 更新前端應用
- ✅ 重啟所有服務
- ✅ 執行完整診斷

**適用情況**:
- 部署後出現問題
- 不確定問題在哪裡
- 想要快速修復所有問題

---

### 🌐 Nginx 工具

#### `setup-nginx.sh`
**用途**: 完整配置 Nginx  
**執行**:
```bash
chmod +x setup-nginx.sh
./setup-nginx.sh
```

**功能**:
- ✅ 自動檢測 SSL 證書
- ✅ 保留 Let's Encrypt 設定
- ✅ 建立 API 轉發配置
- ✅ 備份舊配置
- ✅ 測試並重啟

**適用情況**:
- 首次配置 Nginx
- Nginx 配置完全錯誤
- 需要重新配置

#### `fix-nginx.sh`
**用途**: 快速診斷和修復 Nginx  
**執行**:
```bash
chmod +x fix-nginx.sh
./fix-nginx.sh
```

**功能**:
- ✅ 檢查 Nginx 狀態
- ✅ 測試配置
- ✅ 檢查端口衝突
- ✅ 測試 API 轉發
- ✅ 顯示錯誤日誌

**適用情況**:
- Nginx 無法啟動
- API 請求失敗
- 需要快速診斷

---

### 🎨 前端工具

#### `update-frontend.sh`
**用途**: 快速更新前端  
**執行**:
```bash
chmod +x update-frontend.sh
./update-frontend.sh
```

**功能**:
- ✅ 清理快取
- ✅ 安裝依賴
- ✅ 建置前端
- ✅ 重啟前端服務

**適用情況**:
- 修改了前端代碼
- 前端顯示異常
- API 路徑問題

---

### 🔍 診斷工具

#### `diagnose-api.sh`
**用途**: 完整系統診斷  
**執行**:
```bash
chmod +x diagnose-api.sh
./diagnose-api.sh
```

**功能**:
- ✅ 檢查所有服務狀態
- ✅ 測試 API 連接
- ✅ 檢查資料庫
- ✅ 顯示錯誤日誌
- ✅ 測試新增學生功能

**適用情況**:
- 不確定問題在哪
- 需要詳細報告
- 準備尋求幫助

---

### 📊 管理工具

#### `manage.sh`
**用途**: 日常管理命令  
**執行**:
```bash
./manage.sh [command]
```

**命令**:
- `status` - 查看服務狀態
- `logs` - 查看服務日誌
- `restart` - 重啟服務
- `stop` - 停止服務
- `backup` - 備份資料庫
- `update` - 更新專案（需要 Git）

---

### 📤 上傳工具

#### `upload-fix.bat` (Windows)
**用途**: 從 Windows 上傳修復檔案  
**執行**: 雙擊執行

**功能**:
- ✅ 上傳修復後的前端代碼
- ✅ 上傳所有修復腳本
- ✅ 互動式輸入伺服器資訊

---

## 🎯 常見問題解決流程

### 問題 1: 新增學生失敗

```bash
# 方案 A: 一鍵修復（推薦）
./一鍵修復.sh

# 方案 B: 只更新前端
./update-frontend.sh

# 方案 C: 診斷問題
./diagnose-api.sh
```

### 問題 2: Nginx 無法啟動

```bash
# 方案 A: 快速修復
./fix-nginx.sh

# 方案 B: 重新配置
./setup-nginx.sh

# 方案 C: 查看錯誤
sudo nginx -t
sudo systemctl status nginx
```

### 問題 3: 502 Bad Gateway

```bash
# 檢查後端服務
pm2 list
pm2 restart tutoring-backend

# 查看日誌
pm2 logs tutoring-backend

# 完整診斷
./diagnose-api.sh
```

### 問題 4: 前端無法訪問

```bash
# 重啟前端
pm2 restart tutoring-frontend

# 重新建置
./update-frontend.sh

# 檢查狀態
pm2 logs tutoring-frontend
```

---

## 📋 完整部署流程

### 首次部署

```bash
# 1. 執行部署腳本
chmod +x 簡易部署.sh
./簡易部署.sh

# 2. 配置 Nginx
chmod +x setup-nginx.sh
./setup-nginx.sh

# 3. 診斷檢查
chmod +x diagnose-api.sh
./diagnose-api.sh
```

### 更新部署

```bash
# 方案 A: 一鍵修復
./一鍵修復.sh

# 方案 B: 分步驟
./update-frontend.sh
pm2 restart all
./diagnose-api.sh
```

---

## 🔧 維護命令速查

```bash
# 服務管理
pm2 list                    # 查看服務
pm2 logs                    # 查看日誌
pm2 restart all             # 重啟所有服務
pm2 stop all                # 停止所有服務

# Nginx 管理
sudo systemctl status nginx # 查看狀態
sudo systemctl restart nginx # 重啟
sudo nginx -t               # 測試配置
sudo tail -f /var/log/nginx/tutoring-system.error.log # 查看日誌

# 資料庫管理
./manage.sh backup          # 備份資料庫
sqlite3 tutoring.db ".tables" # 查看資料表

# 系統診斷
./diagnose-api.sh           # 完整診斷
./fix-nginx.sh              # Nginx 診斷
./manage.sh status          # 系統狀態
```

---

## 📚 詳細文檔

- **[Nginx設定指南.md](./Nginx設定指南.md)** - Nginx 詳細配置說明
- **[修復新增學生問題.md](./修復新增學生問題.md)** - 新增學生問題詳解
- **[快速修復指南.md](./快速修復指南.md)** - 快速參考卡片

---

## 💡 最佳實踐

1. **定期備份**
   ```bash
   ./manage.sh backup
   ```

2. **監控日誌**
   ```bash
   pm2 logs
   ```

3. **測試後再部署**
   ```bash
   ./diagnose-api.sh
   ```

4. **保持更新**
   ```bash
   git pull
   ./一鍵修復.sh
   ```

---

## 🆘 需要幫助？

1. **執行診斷**
   ```bash
   ./diagnose-api.sh > diagnosis.txt
   ```

2. **收集日誌**
   ```bash
   pm2 logs --lines 100 > pm2-logs.txt
   sudo tail -100 /var/log/nginx/tutoring-system.error.log > nginx-logs.txt
   ```

3. **檢查瀏覽器 Console** (F12)

4. **提供這些資訊以便進一步診斷**

---

## ⚡ 快速命令

```bash
# 最常用的命令
./一鍵修復.sh              # 修復所有問題
./diagnose-api.sh         # 診斷問題
./manage.sh status        # 查看狀態
pm2 logs                  # 查看日誌
```

記住：遇到問題先執行 `./一鍵修復.sh`，90% 的問題都能自動解決！
