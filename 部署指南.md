# Ubuntu Linux (GCP Cloud) éƒ¨ç½²æŒ‡å—

## ğŸš€ ç³»çµ±éœ€æ±‚

### æœ€ä½é…ç½®
- **CPU**: 1 vCPU
- **è¨˜æ†¶é«”**: 1GB RAM
- **å„²å­˜ç©ºé–“**: 10GB SSD
- **ä½œæ¥­ç³»çµ±**: Ubuntu 20.04 LTS æˆ–æ›´æ–°ç‰ˆæœ¬

### å»ºè­°é…ç½®
- **CPU**: 2 vCPU
- **è¨˜æ†¶é«”**: 2GB RAM
- **å„²å­˜ç©ºé–“**: 20GB SSD

## ğŸ“‹ éƒ¨ç½²æ­¥é©Ÿ

### 1. æº–å‚™ GCP è™›æ“¬æ©Ÿå™¨

```bash
# å»ºç«‹ VM å¯¦ä¾‹ï¼ˆä½¿ç”¨ gcloud CLIï¼‰
gcloud compute instances create tutoring-system \
    --zone=asia-east1-a \
    --machine-type=e2-small \
    --image-family=ubuntu-2004-lts \
    --image-project=ubuntu-os-cloud \
    --boot-disk-size=20GB \
    --tags=http-server,https-server

# è¨­å®šé˜²ç«ç‰†è¦å‰‡
gcloud compute firewall-rules create allow-tutoring-system \
    --allow tcp:3000,tcp:5000 \
    --source-ranges 0.0.0.0/0 \
    --description "Allow access to tutoring system"
```

### 2. é€£æ¥åˆ°è™›æ“¬æ©Ÿå™¨

```bash
# SSH é€£æ¥
gcloud compute ssh tutoring-system --zone=asia-east1-a
```

### 3. å®‰è£å¿…è¦è»Ÿé«”

```bash
# æ›´æ–°ç³»çµ±
sudo apt update && sudo apt upgrade -y

# å®‰è£ Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£ Git
sudo apt install git -y

# å®‰è£ PM2 (é€²ç¨‹ç®¡ç†å™¨)
sudo npm install -g pm2

# é©—è­‰å®‰è£
node --version
npm --version
git --version
```

### 4. éƒ¨ç½²æ‡‰ç”¨ç¨‹å¼

```bash
# å»ºç«‹æ‡‰ç”¨ç¨‹å¼ç›®éŒ„
mkdir -p ~/apps
cd ~/apps

# ä¸Šå‚³å°ˆæ¡ˆæª”æ¡ˆï¼ˆæ–¹æ³•1ï¼šä½¿ç”¨ Gitï¼‰
git clone <your-repository-url> tutoring-system
cd tutoring-system

# æˆ–è€…ä½¿ç”¨ SCP ä¸Šå‚³ï¼ˆæ–¹æ³•2ï¼šå¾æœ¬åœ°ä¸Šå‚³ï¼‰
# åœ¨æœ¬åœ°åŸ·è¡Œï¼š
# gcloud compute scp --recurse ./tutoring-system tutoring-system:~/apps/ --zone=asia-east1-a
```

### 5. å®‰è£ä¾è³´ä¸¦å»ºç½®

```bash
# å®‰è£å¾Œç«¯ä¾è³´
npm install

# å®‰è£å‰ç«¯ä¾è³´ä¸¦å»ºç½®
cd client
npm install
npm run build
cd ..
```

### 6. é…ç½®ç’°å¢ƒè®Šæ•¸

```bash
# å»ºç«‹ç”Ÿç”¢ç’°å¢ƒé…ç½®
cat > .env << EOF
NODE_ENV=production
PORT=5000
HOST=0.0.0.0
EOF
```

### 7. ä½¿ç”¨ PM2 å•Ÿå‹•æœå‹™

```bash
# å•Ÿå‹•å¾Œç«¯æœå‹™
pm2 start server/index.js --name "tutoring-backend"

# å®‰è£ serve ä¾†æä¾›å‰ç«¯éœæ…‹æª”æ¡ˆ
npm install -g serve

# å•Ÿå‹•å‰ç«¯æœå‹™
pm2 start "serve -s client/build -l 3000" --name "tutoring-frontend"

# å„²å­˜ PM2 é…ç½®
pm2 save

# è¨­å®šé–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
pm2 startup
sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u $USER --hp $HOME
```

### 8. è¨­å®š Nginx åå‘ä»£ç†ï¼ˆå¯é¸ï¼‰

```bash
# å®‰è£ Nginx
sudo apt install nginx -y

# å»ºç«‹ Nginx é…ç½®
sudo tee /etc/nginx/sites-available/tutoring-system << EOF
server {
    listen 80;
    server_name your-domain.com;  # æ›¿æ›ç‚ºä½ çš„åŸŸåæˆ– IP

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        proxy_cache_bypass \$http_upgrade;
    }

    # å¾Œç«¯ API
    location /api {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        proxy_cache_bypass \$http_upgrade;
    }
}
EOF

# å•Ÿç”¨ç¶²ç«™
sudo ln -s /etc/nginx/sites-available/tutoring-system /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
sudo systemctl enable nginx
```

## ğŸ”§ ç®¡ç†å‘½ä»¤

### PM2 ç®¡ç†
```bash
# æŸ¥çœ‹æœå‹™ç‹€æ…‹
pm2 status

# æŸ¥çœ‹æ—¥èªŒ
pm2 logs

# é‡å•Ÿæœå‹™
pm2 restart all

# åœæ­¢æœå‹™
pm2 stop all

# åˆªé™¤æœå‹™
pm2 delete all
```

### ç³»çµ±ç›£æ§
```bash
# æŸ¥çœ‹ç³»çµ±è³‡æº
htop

# æŸ¥çœ‹ç£ç¢Ÿä½¿ç”¨
df -h

# æŸ¥çœ‹è¨˜æ†¶é«”ä½¿ç”¨
free -h

# æŸ¥çœ‹ç¶²è·¯é€£æ¥
netstat -tlnp
```

## ğŸ”’ å®‰å…¨è¨­å®š

### 1. è¨­å®šé˜²ç«ç‰†
```bash
# å®‰è£ UFW
sudo apt install ufw -y

# è¨­å®šåŸºæœ¬è¦å‰‡
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443

# å¦‚æœä¸ä½¿ç”¨ Nginxï¼Œé–‹æ”¾æ‡‰ç”¨ç¨‹å¼ç«¯å£
sudo ufw allow 3000
sudo ufw allow 5000

# å•Ÿç”¨é˜²ç«ç‰†
sudo ufw enable
```

### 2. è¨­å®š SSL æ†‘è­‰ï¼ˆä½¿ç”¨ Let's Encryptï¼‰
```bash
# å®‰è£ Certbot
sudo apt install certbot python3-certbot-nginx -y

# ç²å– SSL æ†‘è­‰
sudo certbot --nginx -d your-domain.com

# è¨­å®šè‡ªå‹•æ›´æ–°
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
# 0 12 * * * /usr/bin/certbot renew --quiet
```

## ğŸ“Š ç›£æ§å’Œç¶­è­·

### 1. è¨­å®šæ—¥èªŒè¼ªè½‰
```bash
# å»ºç«‹æ—¥èªŒè¼ªè½‰é…ç½®
sudo tee /etc/logrotate.d/tutoring-system << EOF
/home/$USER/.pm2/logs/*.log {
    daily
    missingok
    rotate 7
    compress
    notifempty
    create 0644 $USER $USER
}
EOF
```

### 2. è³‡æ–™åº«å‚™ä»½
```bash
# å»ºç«‹å‚™ä»½è…³æœ¬
cat > ~/backup-db.sh << EOF
#!/bin/bash
DATE=\$(date +%Y%m%d_%H%M%S)
cp ~/apps/tutoring-system/tutoring.db ~/backups/tutoring_\$DATE.db
find ~/backups -name "tutoring_*.db" -mtime +7 -delete
EOF

chmod +x ~/backup-db.sh
mkdir -p ~/backups

# è¨­å®šå®šæ™‚å‚™ä»½
crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ¯å¤©å‡Œæ™¨ 2 é»å‚™ä»½ï¼‰ï¼š
# 0 2 * * * /home/$USER/backup-db.sh
```

## ğŸŒ è¨ªå•æ‡‰ç”¨ç¨‹å¼

éƒ¨ç½²å®Œæˆå¾Œï¼Œä½ å¯ä»¥é€éä»¥ä¸‹æ–¹å¼è¨ªå•ï¼š

- **ç›´æ¥è¨ªå•**: http://your-vm-ip:3000
- **é€é Nginx**: http://your-domain.com
- **API ç«¯é»**: http://your-vm-ip:5000/api æˆ– http://your-domain.com/api

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ
1. **ç«¯å£è¢«ä½”ç”¨**: ä½¿ç”¨ `sudo netstat -tlnp | grep :3000` æª¢æŸ¥
2. **æ¬Šé™å•é¡Œ**: ç¢ºä¿æª”æ¡ˆæ¬Šé™æ­£ç¢º `chmod -R 755 ~/apps/tutoring-system`
3. **è¨˜æ†¶é«”ä¸è¶³**: ä½¿ç”¨ `free -h` æª¢æŸ¥ï¼Œè€ƒæ…®å¢åŠ  swap
4. **PM2 æœå‹™ç•°å¸¸**: ä½¿ç”¨ `pm2 logs` æŸ¥çœ‹è©³ç´°éŒ¯èª¤

### æ•ˆèƒ½å„ªåŒ–
```bash
# å¢åŠ  swap ç©ºé–“ï¼ˆå¦‚æœè¨˜æ†¶é«”ä¸è¶³ï¼‰
sudo fallocate -l 1G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
```

é€™æ¨£ä½ çš„è£œç¿’ç­ç®¡ç†ç³»çµ±å°±å¯ä»¥åœ¨ GCP çš„ Ubuntu Linux ä¸Šç©©å®šé‹è¡Œäº†ï¼